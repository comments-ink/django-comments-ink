{"version":3,"file":"dci-0.2.0.min.js","mappings":"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","sources":["webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/comment_form.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/reply_forms.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/folding.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/comments.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/utils.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/reactions_panel.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/reactions_handler.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/voting.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/reactions.js","webpack://django-comments-ink/./django_comments_ink/static/django_comments_ink/js/index.js"],"sourcesContent":["export default class CommentForm {\n    constructor(formWrapper) {\n        this.formWrapper = formWrapper;\n        this.init();\n    }\n\n    click_on_post(_) { return this.post(\"post\"); }\n\n    click_on_preview(_) { return this.post(\"preview\"); }\n\n    init() {\n        this.formWrapperEl = document.querySelector(this.formWrapper);\n        this.formEl = this.formWrapperEl.querySelector(\"form\");\n        const post_btn = this.formEl.elements.post;\n        const preview_btn = this.formEl.elements.preview;\n        post_btn.addEventListener(\"click\", (_) => this.post(\"post\"));\n        preview_btn.addEventListener(\"click\", (_) => this.post(\"preview\"));\n        // Change the type of the buttons, otherwise the form is submitted.\n        post_btn.type = \"button\";\n        preview_btn.type = \"button\";\n    }\n\n    disable_btns(value) {\n        this.formEl.elements.post.disabled = value;\n        this.formEl.elements.preview.disabled = value;\n    }\n\n    is_valid() {\n        for (const el of this.formEl.querySelectorAll(\"[required]\")) {\n            if (!el.reportValidity()) {\n                el.focus();\n                return false;\n            }\n        }\n        return true;\n    }\n\n    post(submit_button_name) {\n        if (!this.is_valid()) {\n            return;\n        }\n        this.disable_btns(true);\n\n        // If the <section data-dci=\"preview\">...</section> does exist,\n        // delete it. If the user clicks again in the \"preview\" button\n        // it will be displayed again.\n        const preview = this.formWrapperEl.querySelector(\"[data-dci=preview]\");\n        if (preview) {\n            preview.remove();\n        }\n\n        const formData = new FormData(this.formEl);\n        if (submit_button_name !== undefined) {\n            formData.append(submit_button_name, 1);\n        }\n\n        fetch(this.formEl.action, {\n            method: 'POST',\n            headers: {\n                \"X-Requested-With\": \"XMLHttpRequest\",\n            },\n            body: formData\n        }).then(response => {\n            if (submit_button_name === \"preview\") {\n                this.handle_preview_comment_response(response);\n            } else if (submit_button_name === \"post\") {\n                this.handle_post_comment_response(response);\n            }\n        });\n\n        this.disable_btns(false);\n        return false; // To prevent calling the action attribute.\n    }\n\n    async handle_preview_comment_response(response) {\n        const data = await response.json();\n        if (response.status === 200) {\n            this.formWrapperEl.innerHTML = data.html;\n            this.init();\n            if (data.field_focus) {\n                this.formEl.querySelector(`[name=${data.field_focus}]`).focus();\n            }\n        } else if (response.status === 400) {\n            this.formEl.innerHTML = data.html;\n        }\n    }\n\n    async handle_post_comment_response(response) {\n        const data = await response.json();\n\n        if (response.status === 200) {\n            this.formWrapperEl.innerHTML = data.html;\n            this.init();\n            if (data.field_focus) {\n                this.formEl.querySelector(`[name=${data.field_focus}]`).focus();\n            }\n        }\n        else if (\n            response.status === 201 ||\n            response.status === 202 ||\n            response.status === 400\n        ) {\n            this.formEl.innerHTML = data.html;\n        }\n        else if (response.status > 400) {\n            alert(\n                \"Something went wrong and your comment could not be \" +\n                \"processed. Please, reload the page and try again.\"\n            );\n        }\n    }\n}\n","export default class ReplyFormsHandler {\n    constructor(qsReplyFormBase, qsReplyForms) {\n        this.replyFormBase = document.querySelector(qsReplyFormBase);\n        this.replyMap = new Map();\n\n        const cpage_field = window.djCommentsInk.page_param || \"cpage\";\n\n        for (const elem of document.querySelectorAll(qsReplyForms)) {\n            // Extract the reply_to value from the current reply_form.\n            // Also, it if does exist, extract the comment's page number too.\n            // Then replace the content of elem with a copy of\n            // this.replyFormBase and update the fields reply_to\n            // and comment's page number.\n            const rFormEl = elem.querySelector(\"form\");\n            if (rFormEl === null) {\n                console.error(\n                    `Could not find a reply form within one of ` +\n                    `the elements retrieved with ${qsReplyForms}.`\n                );\n                return;\n            }\n\n            const reply_to = rFormEl.elements.reply_to.value;\n            const cpage = rFormEl.elements[cpage_field]\n                ? rFormEl.elements[cpage_field].value\n                : null;\n\n            const section = this.replyFormBase.cloneNode(true);\n            section.dataset.dci = `reply-form-${reply_to}`;\n\n            // Update fields reply_to and cpage..\n            const newForm = section.querySelector(\"form\");\n            newForm.elements.reply_to.value = reply_to;\n            if (cpage) {\n                newForm.elements[cpage_field].value = cpage;\n            }\n\n            const elemParent = elem.parentNode;\n            elem.replaceWith(section);\n            this.init(reply_to);\n            this.replyMap.set(reply_to, elemParent);\n        }\n    }\n\n    init(reply_to, is_active) {\n        const qs_section = `[data-dci=reply-form-${reply_to}]`;\n        const section = document.querySelector(qs_section);\n\n        // Modify the form (update fields, add event listeners).\n        const newForm = section.querySelector(\"form\");\n        const post_btn = newForm.elements.post;\n        post_btn.addEventListener(\"click\", this.send_clicked(reply_to));\n        const preview_btn = newForm.elements.preview;\n        preview_btn.addEventListener(\"click\", this.preview_clicked(reply_to));\n        const cancel_btn = newForm.elements.cancel;\n        cancel_btn.addEventListener(\"click\", this.cancel_clicked(reply_to));\n        newForm.style.display = \"none\";\n\n        // Attach event listener to textarea.\n        const divta = section.querySelector(\"[data-dci=reply-textarea]\");\n        const ta = divta.querySelector(\"textarea\");\n        ta.addEventListener(\"focus\", this.textarea_focus(reply_to));\n\n        // If is_active is true, hide the textarea and display the form.\n        if (is_active === true) {\n            section.classList.add(\"active\");\n            divta.style.display = \"none\";\n            newForm.style = \"\";\n            newForm.elements.comment.focus();\n        }\n    }\n\n    get_map_item(reply_to) {\n        const item = this.replyMap.get(reply_to);\n        if (item === undefined) {\n            const msg = `replyMap doesn't have a key ${reply_to}`;\n            console.error(msg);\n            throw msg;\n        }\n        return item;\n    }\n\n    disable_buttons(formEl, value) {\n        formEl.elements.post.disabled = value;\n        formEl.elements.preview.disabled = value;\n    }\n\n    is_valid(formEl) {\n        for (const el of formEl.querySelectorAll(\"[required]\")) {\n            if (!el.reportValidity()) {\n                el.focus();\n                return false;\n            }\n        }\n        return true;\n    }\n\n    textarea_focus(reply_to) {\n        // Display the comment form and hide the text area.\n        return (_) => {\n            const item = this.get_map_item(reply_to);\n            const qs_section = `[data-dci=reply-form-${reply_to}`;\n            const section = item.querySelector(qs_section);\n            const form = section.querySelector(\"form\");\n            const divta = section.querySelector(\"[data-dci=reply-textarea]\");\n            section.classList.toggle(\"active\");\n            divta.style.display = \"none\";\n            form.style = \"\";\n            form.elements.comment.focus();\n        };\n    }\n\n    cancel_clicked(reply_to) {\n    // Display the text area and hide the comment form.\n        return (_) => {\n            const item = this.get_map_item(reply_to);\n            const qs_section = `[data-dci=reply-form-${reply_to}`;\n            const section = item.querySelector(qs_section);\n            const form = section.querySelector(\"form\");\n            const divta = section.querySelector(\"[data-dci=reply-textarea]\");\n            const comment_value = form.elements.comment.value;\n            divta.querySelector(\"textarea\").value = comment_value;\n            section.classList.toggle(\"active\");\n            form.style.display = \"none\";\n            divta.style = \"\";\n\n            const previewEl = item.querySelector(\"[data-dci=preview]\");\n            if (previewEl) {\n                previewEl.remove();\n            }\n        };\n    }\n\n    preview_clicked(reply_to) {\n        return (_) => {\n            this.post(\"preview\", reply_to);\n        };\n    }\n\n    send_clicked(reply_to) {\n        return (_) => {\n            this.post(\"post\", reply_to);\n        };\n    }\n\n    post(submit_button_name, reply_to) {\n        const item = this.get_map_item(reply_to);\n        const formEl = item.querySelector(\"form\");\n\n        if (!this.is_valid(formEl)) {\n            return;\n        }\n\n        this.disable_buttons(formEl, true);\n\n        const previewEl = item.querySelector(\"[data-dci=preview]\");\n        if (previewEl) {\n            previewEl.remove();\n        }\n\n        const formData = new FormData(formEl);\n        if (submit_button_name !== undefined) {\n            formData.append(submit_button_name, 1);\n        }\n\n        fetch(formEl.action, {\n            method: \"POST\",\n            headers: {\n                \"X-Requested-With\": \"XMLHttpRequest\",\n            },\n            body: formData\n        }).then(response => {\n            if (submit_button_name === \"preview\") {\n                this.handle_preview_comment_response(response, reply_to);\n            } else if (submit_button_name === \"post\") {\n                this.handle_post_comment_response(response, reply_to);\n            }\n        });\n        this.disable_buttons(formEl, false);\n        return false; // To prevent calling the action attribute.\n    }\n\n    handle_http_200(item, data, reply_to) {\n        item.innerHTML = data.html;\n        this.init(reply_to, true); // 2nd param: is_active = true.\n        if (data.field_focus) {\n            item.querySelector(`[name=${data.field_focus}]`).focus();\n        }\n    }\n\n    handle_http_201_202_400(item, data) {\n        const form = item.querySelector(\"form\");\n        form.innerHTML = data.html;\n    }\n\n    async handle_preview_comment_response(response, reply_to) {\n        const item = this.get_map_item(reply_to);\n        const data = await response.json();\n\n        if (response.status === 200) {\n            this.handle_http_200(item, data, reply_to);\n        } else if (response.status === 400) {\n            this.handle_http_201_202_400(item, data);\n        }\n    }\n\n    async handle_post_comment_response(response, reply_to) {\n        const item = this.get_map_item(reply_to);\n        const data = await response.json();\n\n        if (response.status === 200) {\n            this.handle_http_200(item, data, reply_to);\n        }\n        else if (\n            response.status === 201 ||\n            response.status === 202 ||\n            response.status === 400\n        ) {\n            this.handle_http_201_202_400(item, data);\n        }\n        else if (response.status > 400) {\n            alert(\n                \"Something went wrong and your comment could not be \" +\n                \"processed. Please, reload the page and try again.\"\n            );\n        }\n    }\n}\n","export default class FoldingHandler {\n    constructor(direction) {\n        this.dir = direction; // Direction can be either 'fold' or 'unfold'.\n        this.target_comment = undefined;\n        this.comment_replies = -1;\n\n        const qs = `[data-dci-action=${this.dir}]`;\n        const qs_links = document.querySelectorAll(qs);\n\n        const onLinkClickHandler = this.on_click.bind(this);\n\n        qs_links.forEach(elem => {\n            if (direction === \"fold\") {\n                // By default, when loading the page all comments are\n                // unfolded, so the 'fold' link has to be visible.\n                elem.classList.remove(\"hide\");\n            }\n            // If the fold link is clicked, it should trigger\n            // the folding of the comments underneath.\n            elem.addEventListener(\"click\", onLinkClickHandler);\n        });\n    }\n\n    on_click(event) {\n        event.preventDefault();\n        // Find the <div id=\"comment-{id}\"> of the clicked element.\n        this.target_comment = event.target.closest(\".comment\").parentNode;\n        // Read the number of sibling elements that have to be hidden.\n        this.comment_replies = parseInt(event.target.dataset.dciReplies);\n\n        this.fold_or_unfold_siblings();\n\n        // Hide the link clicked, and make visible the inverse link.\n        const bits = this.target_comment.getAttribute(\"id\").split(\"-\");\n        console.assert(bits.length === 2 && bits[0] === \"comment\");\n        const cm_id = parseInt(bits[1]);\n        this.turn_links(cm_id);\n    }\n\n    turn_links(cm_id) {\n        const dir_lid = `${this.dir}-${cm_id}`;\n        const direct_link = document.getElementById(dir_lid);\n        if (direct_link !== null) {\n            direct_link.classList.add(\"hide\");\n        }\n        const inv_lid = (this.dir === 'fold' ? 'unfold' : 'fold') + `-${cm_id}`;\n        const inverse_link = document.getElementById(inv_lid);\n        if (inverse_link !== null) {\n            inverse_link.classList.remove(\"hide\");\n        }\n    }\n\n    fold_or_unfold_siblings() {\n        let num_processed = 0; // Number of <div id=\"comment-{id}\"> processed.\n        let next_node = this.target_comment.nextElementSibling;\n\n        while(next_node && (num_processed < this.comment_replies)) {\n            const cm_attr_id = next_node.getAttribute(\"id\");\n            const bits = cm_attr_id.split(\"-\");\n\n            // If the node is a <div id=\"reply-to-{id}\"> element, skip it.\n            // They are hidden explicitly when processing the\n            // <div id=\"comment-{id}\"> counterpart.\n\n            if (\n                (bits.length === 3) &&\n                (bits[0] === \"reply\") && (bits[1] === \"to\")\n            ) {\n                next_node = next_node.nextElementSibling;\n                continue;\n            }\n            else if ((bits.length === 2) && (bits[0] === \"comment\")) {\n                const cm_id = parseInt(bits[1]);\n\n                // If the comment has a reply node, toggle it.\n                const reply_id = `reply-to-${cm_id}`;\n                const reply_node = document.getElementById(reply_id);\n                if(reply_node) {\n                    this.toggle(reply_node);\n                }\n\n                this.turn_links(cm_id); // Turn the fold/unfold links.\n                this.toggle(next_node); // Toggle the comment too.\n\n                next_node = next_node.nextElementSibling;\n                num_processed++;\n            }\n        }\n    }\n\n    toggle(node) {\n        if (this.dir === \"fold\") {\n            node.classList.add(\"hide\");\n        } else if (this.dir === \"unfold\") {\n            node.classList.remove(\"hide\");\n        }\n    }\n}\n","import CommentForm from \"./comment_form.js\";\nimport ReplyFormsHandler from \"./reply_forms.js\";\nimport FoldingHandler from \"./folding.js\";\n\n\nfunction init_comments() {\n    if (window.djCommentsInk === null) {\n        return;\n    }\n\n    if (window.djCommentsInk.page_param === undefined) {\n        const rroot = document.querySelector(\"[data-dci=config]\");\n        if (rroot) {\n            window.djCommentsInk.page_param = rroot.getAttribute(\n                \"data-page-qs-param\"\n            );\n        }\n    }\n\n    window.djCommentsInk.comment_form = null;\n    window.djCommentsInk.reply_forms_handler = null;\n\n    // Handler of clicking events on a[data-dci-action=fold] elements.\n    window.djCommentsInk.folding_handler = null;\n    // Handler of clicking events on a[data-dci-action=unfold] elements.\n    window.djCommentsInk.unfolding_handler = null;\n\n    /* ----------------------------------------------\n     * Initialize main comment form.\n     */\n    const qs_cform = \"[data-dci=comment-form]\";\n    if (window.djCommentsInk.comment_form === null &&\n        document.querySelector(qs_cform)\n    ) {\n        window.djCommentsInk.comment_form = new CommentForm(qs_cform);\n    }\n\n    /* ----------------------------------------------\n     * Initialize reply forms.\n     */\n    const qs_rform_base = \"[data-dci=reply-form-template]\";\n    const qs_rforms = \"[data-dci=reply-form]\";\n    if (window.djCommentsInk.reply_forms_handler === null &&\n        document.querySelector(qs_rform_base) &&\n        document.querySelectorAll(qs_rforms)\n    ) {\n        window.djCommentsInk.reply_forms_handler = new ReplyFormsHandler(\n            qs_rform_base, qs_rforms\n        );\n    }\n\n    /* ----------------------------------------------\n     * Initialize fold/unfold of comments with level > 0.\n     */\n    if (window.djCommentsInk.folding_handler === null &&\n        window.djCommentsInk.unfolding_handler === null\n    ) {\n        window.djCommentsInk.folding_handler = new FoldingHandler(\"fold\");\n        window.djCommentsInk.unfolding_handler = new FoldingHandler(\"unfold\");\n    }\n}\n\nexport { init_comments };\n","export function get_cookie(name) {\n    let cookieValue = null;\n    if (document.cookie && document.cookie !== '') {\n        const cookies = document.cookie.split(';');\n        for (let i = 0; i < cookies.length; i++) {\n            const cookie = cookies[i].trim();\n            // Does this cookie string begin with the name we want?\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                break;\n            }\n        }\n    }\n    return cookieValue;\n}\n\nexport function get_login_url(configEl, isGuest) {\n    const url = configEl.getAttribute(\"data-login-url\");\n    if (url === null || url.length === 0) {\n        if (isGuest) {\n            throw new Error(\"Cannot initialize reactions panel => The \" +\n                \"[data-login-url] attribute does not exist or is empty.\");\n        }\n    }\n    return url;\n}\n\nexport function get_react_url(configEl, isGuest) {\n    const url = configEl.getAttribute(\"data-react-url\");\n    if (url === null || url.length === 0) {\n        if (!isGuest) {\n            throw new Error(\"Cannot initialize reactions panel => The \" +\n                \"[data-react-url] attribute does not exist or is empty.\");\n        } else {\n            console.info(\"Couldn't find the data-react-url attribute, \" +\n                \"but the user is anonymous. She has to login first in \" +\n                \"order to post comment reactions.\");\n        }\n    }\n    return url;\n}\n\nexport function get_vote_url(configEl, isGuest) {\n    const url = configEl.getAttribute(\"data-vote-url\");\n    if (url === null || url.length === 0) {\n        if (!isGuest) {\n            throw new Error(\"Cannot initialize reactions panel => The \" +\n                \"[data-vote-url] attribute does not exist or is empty.\");\n        } else {\n            console.info(\"Couldn't find the data-react-url attribute, \" +\n                \"but the user is anonymous. She has to login first in \" +\n                \"order to post comment reactions.\");\n        }\n    }\n    return url;\n}\n","import { get_cookie } from \"./utils\";\n\nconst enter_delay = 0;\nconst exit_delay = 0;\n\nexport default class ReactionsPanel {\n    constructor({panel_el, is_guest, login_url, react_url } = opts) {\n        this.panel_el = panel_el;\n        // this.panel_el.style.zIndex = 1;\n        // this.panel_el.style.display = \"block\";\n        this.arrow_el = panel_el.querySelector(\".arrow\");\n        this.is_guest = is_guest;\n        this.login_url = login_url;\n        this.react_url = react_url;\n\n        // -----------------------------------------------------\n        // The panel_title_elem and its content panel_title will\n        // change when the user hover the buttons of the panel.\n\n        this.panel_title = \"\";\n        this.panel_title_elem = this.panel_el.querySelector(\".title\");\n        if (this.panel_title_elem) {\n            this.panel_title = this.panel_title_elem.textContent;\n        }\n\n        // -----------------------------------------\n        // The comment_id is necessary to know which\n        // comment will receive the reaction code.\n\n        this.comment_id = 0; // Valid comment_id must be > 0.\n        this.next_url = \"\"; // Comment URL to come back after log in.\n\n        this.on_react_btn_click = this.on_react_btn_click.bind(this);\n        this.on_react_btn_mouseover = this.on_react_btn_mouseover.bind(this);\n        this.on_react_btn_mouseout = this.on_react_btn_mouseout.bind(this);\n        this.add_event_listeners();\n    }\n\n    add_event_listeners() {\n        const buttons = this.panel_el.querySelectorAll(\"button\");\n        for (const btn of Array.from(buttons)) {\n            btn.addEventListener(\"click\", this.on_react_btn_click);\n            btn.addEventListener(\"mouseover\", this.on_react_btn_mouseover);\n            btn.addEventListener(\"mouseout\", this.on_react_btn_mouseout);\n        }\n    }\n\n    on_react_btn_click(event) {\n        if (!this.is_guest) {\n            const code = event.target.dataset.code;\n            const react_url = this.react_url.replace(\"0\", this.comment_id);\n            const formData = new FormData();\n            formData.append(\"reaction\", code);\n            formData.append(\"csrfmiddlewaretoken\", get_cookie(\"csrftoken\"));\n\n            fetch(react_url, {\n                method: \"POST\",\n                cache: \"no-cache\",\n                credentials: \"same-origin\",\n                headers: {\n                    \"X-Requested-With\": \"XMLHttpRequest\",\n                },\n                body: formData\n            }).then(response => this.handle_reactions_response(response));\n        } else {\n            window.location.href = `${this.login_url}?next=${this.next_url}`;\n        }\n    }\n\n    async handle_reactions_response(response) {\n        const data = await response.json();\n        if (response.status === 200 ||Â response.status === 201) {\n            const cm_reactions_qs = `#cm-reactions-${this.comment_id}`;\n            const cm_reactions_el = document.querySelector(cm_reactions_qs);\n            if (cm_reactions_el) {\n                cm_reactions_el.innerHTML = data.html;\n            }\n        } else if (response.status > 400) {\n            alert(\n                \"Something went wrong and your comment reaction could not \" +\n                \"be processed. Please, reload the page and try again.\"\n            );\n        }\n    }\n\n    on_react_btn_mouseover(event) {\n        if (this.panel_title_elem) {\n            this.panel_title_elem.textContent = event.target.dataset.title;\n        }\n    }\n\n    on_react_btn_mouseout(_) {\n        this.panel_title_elem.textContent = this.panel_title;\n    }\n\n    set_position(trigger_elem) {\n        this.panel_el.style.display = \"block\";\n\n        const panel_elem_coords = this.get_absolute_coords(this.panel_el);\n        const trigger_elem_coords = this.get_absolute_coords(trigger_elem);\n\n        const panel_elem_width = panel_elem_coords.width;\n        const panel_elem_height = panel_elem_coords.height;\n        const panel_elem_top = panel_elem_coords.top;\n        const panel_elem_left = panel_elem_coords.left;\n\n        const trigger_elem_width = trigger_elem_coords.width;\n        const trigger_elem_top = trigger_elem_coords.top;\n        const trigger_elem_left = trigger_elem_coords.left;\n\n        const top_diff = trigger_elem_top - panel_elem_top;\n        const left_diff = trigger_elem_left - panel_elem_left;\n\n        // This group of const values can be hardcoded somewhere else.\n        // const position = \"auto\";\n        const margin = 8;\n\n        const width_center = trigger_elem_width / 2 - panel_elem_width / 2;\n\n        const left = left_diff + width_center;\n        const top = top_diff - panel_elem_height - margin;\n        const from_top = top + 10;\n\n        this.panel_el.dataset.fromLeft = left;\n        this.panel_el.dataset.fromTop = from_top;\n        this.panel_el.dataset.left = left;\n        this.panel_el.dataset.top = top;\n\n        // Arrow.\n        if (this.arrow_el) {\n            let arrow_left = 0;\n            const full_left = left + panel_elem_left;\n            const t_width_center = trigger_elem_width / 2 + trigger_elem_left;\n            arrow_left = t_width_center - full_left;\n            const transform_text = `translate3d(${arrow_left}px, 0px, 0)`;\n            this.arrow_el.style.transform = transform_text;\n        }\n    }\n\n    hide() {\n        clearTimeout(this.enter_delay_timeout);\n\n        this.exit_delat_timeout = setTimeout(() => {\n            if (this.panel_el) {\n                const left = this.panel_el.dataset.fromLeft;\n                const top = this.panel_el.dataset.fromTop;\n                const transform_text = `translate3d(${left}px, ${top}px, 0)`;\n\n                this.panel_el.style.transform = transform_text;\n                this.panel_el.style.opacity = 0;\n                this.panel_el.style.display = \"none\";\n                this.panel_el.style.zIndex = 0;\n            }\n        }, exit_delay);\n    }\n\n    show(trigger_elem, comment_id) {\n        this.comment_id = comment_id;\n        this.next_url = trigger_elem.dataset.loginNext || \"\";\n        this.panel_el.style.transform = \"none\";\n        this.set_position(trigger_elem);\n\n        this.enter_delay_timeout = setTimeout(() => {\n            const left = this.panel_el.dataset.left;\n            const top = this.panel_el.dataset.top;\n            const transform_text = `translate3d(${left}px, ${top}px, 0)`;\n\n            this.panel_el.style.zIndex = 1;\n            this.panel_el.style.display = \"block\";\n            this.panel_el.style.transform = transform_text;\n            this.panel_el.style.opacity = 1;\n        }, enter_delay);\n    }\n\n    get_absolute_coords(elem) {\n        if (!elem) {\n            return;\n        }\n\n        const box = elem.getBoundingClientRect();\n        const page_x = window.pageXOffset;\n        const page_y = window.pageYOffset;\n\n        return {\n            width: box.width,\n            height: box.height,\n            top: box.top + page_y,\n            right: box.right + page_x,\n            bottom: box.bottom + page_y,\n            left: box.left + page_x,\n        };\n    }\n}\n","import ReactionsPanel from \"./reactions_panel\";\nimport { get_login_url, get_react_url } from \"./utils\";\n\n\nexport default class ReactionsHandler {\n    constructor(configEl) {\n        this.cfg_el = configEl;\n        this.is_guest = this.cfg_el.dataset.guestUser === \"1\";\n        this.is_input_allowed = this.cfg_el.dataset.inputAllowed === \"1\";\n        this.login_url = get_login_url(this.cfg_el, this.is_guest);\n        this.react_url = get_react_url(this.cfg_el, this.is_guest);\n\n        // Initialize the buttons panels and their components.\n        this.links = document.querySelectorAll(\"[data-dci=reactions-panel]\");\n        if (this.links.length === 0 && this.is_input_allowed) {\n            throw new Error(\n                \"Cannot initialize reactions panel => There are \" +\n                \"no elements with [data-dci=reactions-panel].\");\n        }\n        this.active_visible_panel = \"0\";\n        this.panels_visibility = new Map(); // Keys are 'comment_id'.\n        this.event_handlers = [];\n        this.add_event_listeners();\n        this.listen_to_click_on_links();\n        const qs_panel = \"[data-dci=reactions-panel-template]\";\n        this.panel_el = document.querySelector(qs_panel);\n        if (this.panel_el === undefined) {\n            throw new Error(\"Cannot find element with ${qs_panel}.\");\n        }\n\n        // Create object of class ReactionsPanel in charge of showing and\n        // hiding the reactions panel around the clicked 'react' link.\n        const opts = {\n            panel_el: this.panel_el,\n            is_guest: this.is_guest,\n            login_url: this.login_url,\n            react_url: this.react_url\n        };\n        this.reactions_panel = new ReactionsPanel(opts);\n    }\n\n    on_document_click(event) {\n        const data_attr = event.target.getAttribute(\"data-dci\");\n        if (!data_attr || data_attr !== \"reactions-panel\") {\n            this.reactions_panel.hide();\n            if (this.active_visible_panel !== \"0\") {\n                this.panels_visibility.set(this.active_visible_panel, false);\n                this.active_visible_panel = \"0\";\n            }\n        }\n    }\n\n    on_document_key_up(event) {\n        if (event.key === \"Escape\") {\n            this.reactions_panel.hide();\n            if (this.active_visible_panel !== \"0\") {\n                this.panels_visibility.set(this.active_visible_panel, false);\n                this.active_visible_panel = \"0\";\n            }\n        }\n    }\n\n    add_event_listeners() {\n        const onDocumentClickHandler = this.on_document_click.bind(this);\n        const onDocumentKeyUpHandler = this.on_document_key_up.bind(this);\n\n        window.document.addEventListener('click', onDocumentClickHandler);\n        window.document.addEventListener('keyup', onDocumentKeyUpHandler);\n\n        this.event_handlers.push({\n            elem: window.document,\n            event: 'click',\n            handler: this.on_document_click,\n        });\n        this.event_handlers.push({\n            elem: window.document,\n            event: 'keyup',\n            handler: this.on_document_key_up,\n        });\n    }\n\n    remove_event_listeners() {\n        for (const item of this.event_handlers) {\n            item.elem.removeEventListener(item.event, item.handler);\n        }\n    }\n\n    listen_to_click_on_links() {\n        for (const elem of Array.from(this.links)) {\n            const comment_id = elem.getAttribute(\"data-comment\");\n            if (comment_id === null) {\n                continue;\n            }\n            const click_handler = this.toggle_reactions_panel(comment_id);\n            elem.addEventListener(\"click\", click_handler);\n            this.event_handlers.push({\n                'elem': elem,\n                'event': 'click',\n                'handler': click_handler\n            });\n            this.panels_visibility.set(comment_id, false); // Not visible yet.\n        }\n    }\n\n    toggle_reactions_panel(comment_id) {\n        return (event) => {\n            event.preventDefault();\n            const is_visible = this.panels_visibility.get(comment_id);\n            if (!is_visible) {\n                this.active_visible_panel = comment_id;\n                this.reactions_panel.show(event.target, comment_id);\n            } else {\n                this.active_visible_panel = \"0\";\n                this.reactions_panel.hide();\n            }\n            this.panels_visibility.set(comment_id, !is_visible);\n        };\n    }\n}\n","import { get_cookie, get_login_url, get_vote_url } from \"./utils\";\n\n\nexport default class VotingHandler {\n    constructor(configEl) {\n        this.cfg_el = configEl;\n\n        this.is_guest = this.cfg_el.getAttribute(\"data-guest-user\") === \"1\";\n        this.login_url = get_login_url(this.cfg_el, this.is_guest);\n        this.vote_url = get_vote_url(this.cfg_el, this.is_guest);\n\n        this.qs_up = '[data-dci-action=\"vote-up\"]';\n        this.qs_down = '[data-dci-action=\"vote-down\"]';\n        const qs_vote_up = document.querySelectorAll(this.qs_up);\n        const qs_vote_down = document.querySelectorAll(this.qs_down);\n\n        this.on_click = this.on_click.bind(this);\n        qs_vote_up.forEach(el => el.addEventListener(\"click\", this.on_click));\n        qs_vote_down.forEach(el => el.addEventListener(\"click\", this.on_click));\n    }\n\n    on_click(event) {\n        event.preventDefault();\n        const target = event.target;\n        if (!this.is_guest) {\n            this.comment_id = target.dataset.comment;\n            const vote_url = this.vote_url.replace(\"0\", this.comment_id);\n            const code = target.dataset.code;\n            const form_data = new FormData();\n            form_data.append(\"vote\", code);\n            form_data.append(\"csrfmiddlewaretoken\", get_cookie(\"csrftoken\"));\n\n            fetch(vote_url, {\n                method: \"POST\",\n                cache: \"no-cache\",\n                credentials: \"same-origin\",\n                headers: {\n                    \"X-Requested-With\": \"XMLHttpRequest\",\n                },\n                body: form_data\n            }).then(response => this.handle_vote_response(response));\n        }\n        else {\n            const next_url = target.dataset.loginNext;\n            window.location.href = `${this.login_url}?next=${next_url}`;\n        }\n    }\n\n    async handle_vote_response(response) {\n        const data = await response.json();\n        if (response.status === 200 || response.status === 201) {\n            const cm_votes_qs = `#cm-votes-${this.comment_id}`;\n            const cm_votes_el = document.querySelector(cm_votes_qs);\n            if (cm_votes_el) {\n                cm_votes_el.innerHTML = data.html;\n                const qs_vote_up = cm_votes_el.querySelector(this.qs_up);\n                if (qs_vote_up) {\n                    qs_vote_up.addEventListener(\"click\", this.on_click);\n                }\n                const qs_vote_down = cm_votes_el.querySelector(this.qs_down);\n                if (qs_vote_down) {\n                    qs_vote_down.addEventListener(\"click\", this.on_click);\n                }\n            }\n        } else if (response.status > 400) {\n            alert(\n                \"Something went wrong and your comment vote could not \" +\n                \"be processed. Please, reload the page and try again.\"\n            );\n        }\n    }\n}\n","import ReactionsHandler from \"./reactions_handler\";\nimport VotingHandler from \"./voting.js\";\n\n\nfunction init_reactions() {\n    const cfg = document.querySelector(\"[data-dci=config]\");\n    if (cfg === null || window.djCommentsInk === null) {\n        return;\n    }\n\n    window.djCommentsInk.reactions_handler = null;\n\n    // Handler for clicking events on vote up/down elements.\n    window.djCommentsInk.voting_handler = null;\n\n    /* ----------------------------------------------\n     * Initialize reactions_handler, in charge\n     * of all reactions popover components.\n     */\n    if (window.djCommentsInk.reactions_handler === null) {\n        window.djCommentsInk.reactions_handler = new ReactionsHandler(cfg);\n        window.addEventListener(\"beforeunload\", (_) => {\n            window.djCommentsInk.reactions_handler.remove_event_listeners();\n        });\n    }\n\n    /* ----------------------------------------------\n     * Initialize voting up/down of comments with level == 0.\n     */\n    if (window.djCommentsInk.voting_handler === null) {\n        window.djCommentsInk.voting_handler = new VotingHandler(cfg);\n    }\n}\n\nexport { init_reactions };\n","import { init_comments } from \"./comments.js\";\nimport { init_reactions } from \"./reactions.js\";\n\nwindow.djCommentsInk = {\n    init_comments: init_comments,\n    init_reactions: init_reactions\n};\n\nwindow.addEventListener(\"DOMContentLoaded\", (_) => {\n    init_comments();\n    init_reactions();\n});\n"],"names":["CommentForm","constructor","formWrapper","this","init","click_on_post","_","post","click_on_preview","formWrapperEl","document","querySelector","formEl","post_btn","elements","preview_btn","preview","addEventListener","type","disable_btns","value","disabled","is_valid","el","querySelectorAll","reportValidity","focus","submit_button_name","remove","formData","FormData","undefined","append","fetch","action","method","headers","body","then","response","handle_preview_comment_response","handle_post_comment_response","async","data","json","status","innerHTML","html","field_focus","alert","ReplyFormsHandler","qsReplyFormBase","qsReplyForms","replyFormBase","replyMap","Map","cpage_field","window","djCommentsInk","page_param","elem","rFormEl","console","error","reply_to","cpage","section","cloneNode","dataset","dci","newForm","elemParent","parentNode","replaceWith","set","is_active","qs_section","send_clicked","preview_clicked","cancel","cancel_clicked","style","display","divta","textarea_focus","classList","add","comment","get_map_item","item","get","msg","disable_buttons","form","toggle","comment_value","previewEl","handle_http_200","handle_http_201_202_400","FoldingHandler","direction","dir","target_comment","comment_replies","qs","qs_links","onLinkClickHandler","on_click","bind","forEach","event","preventDefault","target","closest","parseInt","dciReplies","fold_or_unfold_siblings","bits","getAttribute","split","assert","length","cm_id","turn_links","dir_lid","direct_link","getElementById","inv_lid","inverse_link","num_processed","next_node","nextElementSibling","reply_id","reply_node","node","init_comments","rroot","comment_form","reply_forms_handler","folding_handler","unfolding_handler","qs_cform","qs_rform_base","qs_rforms","get_cookie","name","cookieValue","cookie","cookies","i","trim","substring","decodeURIComponent","get_login_url","configEl","isGuest","url","Error","ReactionsPanel","panel_el","is_guest","login_url","react_url","opts","arrow_el","panel_title","panel_title_elem","textContent","comment_id","next_url","on_react_btn_click","on_react_btn_mouseover","on_react_btn_mouseout","add_event_listeners","buttons","btn","Array","from","location","href","code","replace","cache","credentials","handle_reactions_response","cm_reactions_qs","cm_reactions_el","title","set_position","trigger_elem","panel_elem_coords","get_absolute_coords","trigger_elem_coords","panel_elem_width","width","panel_elem_height","height","panel_elem_top","top","panel_elem_left","left","trigger_elem_width","trigger_elem_top","trigger_elem_left","from_top","fromLeft","fromTop","arrow_left","transform_text","transform","hide","clearTimeout","enter_delay_timeout","exit_delat_timeout","setTimeout","opacity","zIndex","show","loginNext","box","getBoundingClientRect","page_x","pageXOffset","page_y","pageYOffset","right","bottom","ReactionsHandler","cfg_el","guestUser","is_input_allowed","inputAllowed","get_react_url","info","links","active_visible_panel","panels_visibility","event_handlers","listen_to_click_on_links","reactions_panel","on_document_click","data_attr","on_document_key_up","key","onDocumentClickHandler","onDocumentKeyUpHandler","push","handler","remove_event_listeners","removeEventListener","click_handler","toggle_reactions_panel","is_visible","VotingHandler","vote_url","get_vote_url","qs_up","qs_down","qs_vote_up","qs_vote_down","form_data","handle_vote_response","cm_votes_qs","cm_votes_el","init_reactions","cfg","reactions_handler","voting_handler"],"sourceRoot":""}